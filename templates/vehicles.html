{% extends "base.html" %}

{% block title %}Vehicles - PiBox{% endblock %}

{% block content %}
<style>
    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
        margin-top: 20px;
        flex-wrap: wrap;
    }
    .pagination a, .pagination span {
        padding: 8px 14px;
        border-radius: 6px;
        text-decoration: none;
        font-size: 14px;
    }
    .pagination a {
        background: #2a2a2a;
        color: #fff;
        border: 1px solid #3a3a3a;
    }
    .pagination a:hover {
        background: #3a3a3a;
    }
    .pagination .current {
        background: #4a9eff;
        color: #fff;
        font-weight: bold;
    }
    .pagination .disabled {
        background: #1a1a1a;
        color: #666;
        cursor: not-allowed;
    }
    .pagination-info {
        color: #888;
        font-size: 13px;
        margin: 0 10px;
    }
    .page-size-select {
        background: #2a2a2a;
        color: #fff;
        border: 1px solid #3a3a3a;
        padding: 6px 10px;
        border-radius: 6px;
        margin-left: 10px;
    }
    .search-form {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    .search-form input {
        flex: 1;
    }
    .search-form button {
        padding: 8px 16px;
    }
    .clear-search {
        color: #ff6b6b;
        text-decoration: none;
        font-size: 13px;
    }
</style>

<div class="page">
    <div class="page-header">
        <h1>Registered Vehicles</h1>
        <div class="header-actions">
            <form class="search-form" method="get" action="/vehicles">
                <input type="text" name="search" value="{{ search }}" placeholder="Search plate..." class="search-input">
                <button type="submit" class="btn btn-primary">Search</button>
                {% if search %}
                <a href="/vehicles" class="clear-search">Clear</a>
                {% endif %}
            </form>
            <span class="badge">{{ total }} vehicles</span>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <table class="data-table" id="vehicles-table">
                <thead>
                    <tr>
                        <th>Plate</th>
                        <th>Owner</th>
                        <th>Unit</th>
                        <th>Valid From</th>
                        <th>Valid To</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for v in vehicles %}
                    <tr>
                        <td class="plate-cell">{{ v.plate }}</td>
                        <td>{{ v.owner_name or '-' }}</td>
                        <td>{{ v.unit_name or '-' }}</td>
                        <td>{{ v.valid_from or '-' }}</td>
                        <td>{{ v.valid_to or '-' }}</td>
                        <td>
                            <span class="status-badge {% if v.active %}success{% else %}danger{% endif %}">
                                {{ 'Active' if v.active else 'Inactive' }}
                            </span>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" style="text-align: center; color: #888;">
                            {% if search %}
                            No vehicles found matching "{{ search }}"
                            {% else %}
                            No vehicles registered
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            {% if total_pages > 1 %}
            <div class="pagination">
                <!-- Previous button -->
                {% if page > 1 %}
                <a href="?page={{ page - 1 }}&per_page={{ per_page }}{% if search %}&search={{ search }}{% endif %}">&laquo; Prev</a>
                {% else %}
                <span class="disabled">&laquo; Prev</span>
                {% endif %}

                <!-- Page numbers -->
                {% set start_page = [1, page - 2]|max %}
                {% set end_page = [total_pages, page + 2]|min %}

                {% if start_page > 1 %}
                <a href="?page=1&per_page={{ per_page }}{% if search %}&search={{ search }}{% endif %}">1</a>
                {% if start_page > 2 %}
                <span class="pagination-info">...</span>
                {% endif %}
                {% endif %}

                {% for p in range(start_page, end_page + 1) %}
                {% if p == page %}
                <span class="current">{{ p }}</span>
                {% else %}
                <a href="?page={{ p }}&per_page={{ per_page }}{% if search %}&search={{ search }}{% endif %}">{{ p }}</a>
                {% endif %}
                {% endfor %}

                {% if end_page < total_pages %}
                {% if end_page < total_pages - 1 %}
                <span class="pagination-info">...</span>
                {% endif %}
                <a href="?page={{ total_pages }}&per_page={{ per_page }}{% if search %}&search={{ search }}{% endif %}">{{ total_pages }}</a>
                {% endif %}

                <!-- Next button -->
                {% if page < total_pages %}
                <a href="?page={{ page + 1 }}&per_page={{ per_page }}{% if search %}&search={{ search }}{% endif %}">Next &raquo;</a>
                {% else %}
                <span class="disabled">Next &raquo;</span>
                {% endif %}

                <!-- Page info -->
                <span class="pagination-info">
                    Page {{ page }} of {{ total_pages }}
                </span>

                <!-- Per page selector -->
                <select class="page-size-select" onchange="changePerPage(this.value)">
                    <option value="25" {% if per_page == 25 %}selected{% endif %}>25</option>
                    <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                    <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
                </select>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function changePerPage(value) {
        const url = new URL(window.location);
        url.searchParams.set('per_page', value);
        url.searchParams.set('page', '1');
        window.location = url;
    }
</script>
{% endblock %}